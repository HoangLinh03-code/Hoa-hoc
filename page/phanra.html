<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√¥ ph·ªèng: S·ª± ph√¢n r√£ Ph√≥ng x·∫°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .slider-container {
            margin-bottom: 20px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        .slider-value {
            color: #667eea;
            font-weight: bold;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            transition: 0.3s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            background: #764ba2;
            transform: scale(1.2);
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-start {
            background: #4CAF50;
            color: white;
        }
        
        .btn-start:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .btn-pause {
            background: #ff9800;
            color: white;
        }
        
        .btn-pause:hover {
            background: #e68900;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }
        
        .btn-reset {
            background: #f44336;
            color: white;
        }
        
        .btn-reset:hover {
            background: #da190b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .display-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .display-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .display-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .display-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }
        
        canvas {
            width: 100%;
            height: 400px;
            border: 3px solid #667eea;
            border-radius: 10px;
            background: #1a1a2e;
            display: block;
            margin-bottom: 15px;
        }
        
        .chart-container {
            width: 100%;
            height: 250px;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #333;
        }
        
        .progress-container {
            margin-top: 15px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #666;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff3333, #ff6666);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .progress-decayed {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #888, #555);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .instructions {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .instructions h2 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .instructions ol {
            margin-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            color: #856404;
            line-height: 1.6;
        }
        
        .formula {
            background: #e8eaf6;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            color: #333;
            border-left: 4px solid #667eea;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .display-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ M√¥ ph·ªèng: S·ª± ph√¢n r√£ Ph√≥ng x·∫°</h1>
        <p class="subtitle">Kh√°m ph√° qu√° tr√¨nh ph√¢n r√£ h·∫°t nh√¢n theo th·ªùi gian</p>
        
        <div class="formula">
            N(t) = N‚ÇÄ ¬∑ (1/2)^(t/T)
        </div>
        
        <div class="main-content">
            <!-- C·ªôt tr√°i: Thi·∫øt l·∫≠p v√† ƒêi·ªÅu khi·ªÉn -->
            <div>
                <div class="section">
                    <h2>‚öôÔ∏è Thi·∫øt l·∫≠p</h2>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>S·ªë h·∫°t ban ƒë·∫ßu (N‚ÇÄ):</span>
                            <span class="slider-value" id="n0-value">500</span>
                        </div>
                        <input type="range" id="n0-slider" min="100" max="1000" value="500" step="50">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Chu k·ª≥ b√°n r√£ (T):</span>
                            <span class="slider-value" id="t-value">5.0s</span>
                        </div>
                        <input type="range" id="t-slider" min="1" max="10" value="5" step="0.5">
                    </div>
                </div>
                
                <div class="section">
                    <h2>üéÆ ƒêi·ªÅu khi·ªÉn</h2>
                    <div class="controls">
                        <button class="btn-start" id="start-btn">‚ñ∂ B·∫Øt ƒë·∫ßu</button>
                        <button class="btn-pause" id="pause-btn" disabled>‚è∏ T·∫°m d·ª´ng</button>
                        <button class="btn-reset" id="reset-btn">‚Üª Reset</button>
                    </div>
                </div>
                
                <div class="section">
                    <h2>üìä Hi·ªÉn th·ªã K·∫øt qu·∫£</h2>
                    <div class="display-grid">
                        <div class="display-item">
                            <div class="display-label">Th·ªùi gian (t)</div>
                            <div class="display-value" id="time-display">0.0s</div>
                        </div>
                        <div class="display-item">
                            <div class="display-label">S·ªë h·∫°t c√≤n l·∫°i N(t)</div>
                            <div class="display-value" id="remaining-display">500</div>
                        </div>
                        <div class="display-item">
                            <div class="display-label">S·ªë h·∫°t ƒë√£ ph√¢n r√£</div>
                            <div class="display-value" id="decayed-display">0</div>
                        </div>
                        <div class="display-item">
                            <div class="display-label">Ph·∫ßn trƒÉm c√≤n l·∫°i</div>
                            <div class="display-value" id="percent-display">100%</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- C·ªôt ph·∫£i: Canvas v√† ƒê·ªì th·ªã -->
            <div>
                <div class="section" style="padding: 10px;">
                    <canvas id="canvas"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ff3333;"></div>
                            <span>H·∫°t ch∆∞a ph√¢n r√£</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #555555;"></div>
                            <span>H·∫°t ƒë√£ ph√¢n r√£</span>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>T·ªâ l·ªá h·∫°t nh√¢n:</span>
                            <span id="ratio-text">100% c√≤n l·∫°i | 0% ƒë√£ ph√¢n r√£</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-remaining" style="width: 100%;">
                                <span id="remaining-percent">100%</span>
                            </div>
                            <div class="progress-decayed" id="progress-decayed" style="width: 0%;">
                                <span id="decayed-percent"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section" style="padding: 15px;">
                    <h3 style="color: #667eea; margin-bottom: 10px; font-size: 1.1em;">üìà ƒê·ªì th·ªã ph√¢n r√£ theo th·ªùi gian</h3>
                    <div class="chart-container">
                        <canvas id="chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Gi·∫£i th√≠ch th√≠ nghi·ªám -->
        <div class="instructions">
            <h2>üìö Gi·∫£i th√≠ch th√≠ nghi·ªám: S·ª± ph√¢n r√£ Ph√≥ng x·∫°</h2>
            
            <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px;">üî¨ Hi·ªán t∆∞·ª£ng ph√¢n r√£ ph√≥ng x·∫° l√† g√¨?</h3>
            <p style="line-height: 1.8; color: #333; margin-bottom: 15px;">
                <strong>Ph√¢n r√£ ph√≥ng x·∫°</strong> l√† qu√° tr√¨nh m√† h·∫°t nh√¢n nguy√™n t·ª≠ kh√¥ng b·ªÅn v·ªØng t·ª± ph√°t bi·∫øn ƒë·ªïi th√†nh h·∫°t nh√¢n kh√°c, 
                ƒë·ªìng th·ªùi ph√°t ra c√°c tia ph√≥ng x·∫° (alpha, beta, gamma). ƒê√¢y l√† m·ªôt <strong>qu√° tr√¨nh ng·∫´u nhi√™n</strong> - 
                ch√∫ng ta kh√¥ng th·ªÉ d·ª± ƒëo√°n ch√≠nh x√°c h·∫°t nh√¢n n√†o s·∫Ω ph√¢n r√£ v√†o th·ªùi ƒëi·ªÉm n√†o, nh∆∞ng c√≥ th·ªÉ d·ª± ƒëo√°n ƒë∆∞·ª£c 
                <strong>s·ªë l∆∞·ª£ng h·∫°t nh√¢n</strong> c√≤n l·∫°i sau m·ªôt kho·∫£ng th·ªùi gian nh·∫•t ƒë·ªãnh.
            </p>
            
            <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px;">üìê C√¥ng th·ª©c ph√¢n r√£ v√† √Ω nghƒ©a</h3>
            <div style="background: #f0f4ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #667eea;">
                <p style="margin: 0; font-size: 1.1em; text-align: center; font-family: 'Courier New', monospace;"><strong>N(t) = N‚ÇÄ ¬∑ (1/2)^(t/T)</strong></p>
            </div>
            <p style="line-height: 1.8; color: #333; margin-bottom: 10px;">Trong ƒë√≥:</p>
            <ul style="line-height: 1.8; color: #333; margin-left: 20px; margin-bottom: 15px;">
                <li><strong>N(t)</strong>: S·ªë h·∫°t nh√¢n c√≤n l·∫°i t·∫°i th·ªùi ƒëi·ªÉm t</li>
                <li><strong>N‚ÇÄ</strong>: S·ªë h·∫°t nh√¢n ban ƒë·∫ßu (l√∫c t = 0)</li>
                <li><strong>t</strong>: Th·ªùi gian ƒë√£ tr√¥i qua</li>
                <li><strong>T</strong>: Chu k·ª≥ b√°n r√£ (half-life) - th·ªùi gian ƒë·ªÉ m·ªôt n·ª≠a s·ªë h·∫°t nh√¢n ph√¢n r√£</li>
                <li><strong>(1/2)^(t/T)</strong>: Ph·∫ßn c√≤n l·∫°i sau th·ªùi gian t, t√≠nh theo s·ªë l·∫ßn b√°n r√£</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px;">üí° T·∫°i sao c√¥ng th·ª©c l·∫°i c√≥ d·∫°ng nh∆∞ v·∫≠y?</h3>
            <p style="line-height: 1.8; color: #333; margin-bottom: 15px;">
                C√¥ng th·ª©c n√†y th·ªÉ hi·ªán <strong>quy lu·∫≠t gi·∫£m theo h√†m m≈©</strong>. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√†:
            </p>
            <ul style="line-height: 1.8; color: #333; margin-left: 20px; margin-bottom: 15px;">
                <li>Sau m·ªói chu k·ª≥ b√°n r√£ T, s·ªë h·∫°t nh√¢n c√≤n l·∫°i <strong>gi·∫£m ƒëi m·ªôt n·ª≠a</strong></li>
                <li>T·ªëc ƒë·ªô ph√¢n r√£ t·ªâ l·ªá thu·∫≠n v·ªõi s·ªë h·∫°t c√≤n l·∫°i (c√†ng nhi·ªÅu h·∫°t th√¨ c√†ng nhi·ªÅu h·∫°t ph√¢n r√£)</li>
                <li>Qu√° tr√¨nh n√†y <strong>kh√¥ng bao gi·ªù d·ª´ng h·∫≥n</strong> - lu√¥n c√≤n m·ªôt s·ªë h·∫°t ch∆∞a ph√¢n r√£ (v·ªÅ m·∫∑t l√Ω thuy·∫øt)</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px;">üìä V√≠ d·ª• minh h·ªça c·ª• th·ªÉ</h3>
            <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #4CAF50;">
                <p style="margin: 0 0 10px 0; color: #2e7d32;"><strong>Gi·∫£ s·ª≠:</strong> N‚ÇÄ = 800 h·∫°t, T = 4 gi√¢y</p>
                <ul style="line-height: 1.8; color: #2e7d32; margin-left: 20px; margin-bottom: 0;">
                    <li><strong>t = 0s</strong>: N(0) = 800 ¬∑ (1/2)^(0/4) = 800 ¬∑ 1 = <strong>800 h·∫°t</strong></li>
                    <li><strong>t = 4s</strong> (sau 1 chu k·ª≥): N(4) = 800 ¬∑ (1/2)^(4/4) = 800 ¬∑ 1/2 = <strong>400 h·∫°t</strong></li>
                    <li><strong>t = 8s</strong> (sau 2 chu k·ª≥): N(8) = 800 ¬∑ (1/2)^(8/4) = 800 ¬∑ 1/4 = <strong>200 h·∫°t</strong></li>
                    <li><strong>t = 12s</strong> (sau 3 chu k·ª≥): N(12) = 800 ¬∑ (1/2)^(12/4) = 800 ¬∑ 1/8 = <strong>100 h·∫°t</strong></li>
                    <li><strong>t = 16s</strong> (sau 4 chu k·ª≥): N(16) = 800 ¬∑ (1/2)^(16/4) = 800 ¬∑ 1/16 = <strong>50 h·∫°t</strong></li>
                </ul>
            </div>
            
            <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px;">üß™ Th·ª≠ nghi·ªám v·ªõi m√¥ ph·ªèng</h3>
            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                <p style="margin: 0 0 10px 0; color: #856404;"><strong>H√£y th·ª≠ c√°c b∆∞·ªõc sau ƒë·ªÉ ki·ªÉm ch·ª©ng c√¥ng th·ª©c:</strong></p>
                <ol style="line-height: 1.8; color: #856404; margin-left: 20px; margin-bottom: 0;">
                    <li>ƒê·∫∑t N‚ÇÄ = 800, T = 4s (nh∆∞ v√≠ d·ª• tr√™n)</li>
                    <li>Nh·∫•n "B·∫Øt ƒë·∫ßu" v√† quan s√°t t·∫°i c√°c m·ªëc th·ªùi gian t = 4s, 8s, 12s, 16s</li>
                    <li>So s√°nh s·ªë h·∫°t c√≤n l·∫°i tr√™n m√†n h√¨nh v·ªõi k·∫øt qu·∫£ t√≠nh to√°n ·ªü v√≠ d·ª•</li>
                    <li>Th·ª≠ thay ƒë·ªïi T v√† quan s√°t t·ªëc ƒë·ªô ph√¢n r√£ thay ƒë·ªïi nh∆∞ th·∫ø n√†o</li>
                    <li>Ch√∫ √Ω: S·ªë h·∫°t th·ª±c t·∫ø c√≥ th·ªÉ dao ƒë·ªông nh·∫π do t√≠nh ng·∫´u nhi√™n c·ªßa qu√° tr√¨nh ph√¢n r√£</li>
                </ol>
            </div>
            
            <h3 style="color: #667eea; margin-top: 15px; margin-bottom: 10px;">üåç ·ª®ng d·ª•ng th·ª±c t·∫ø</h3>
            <ul style="line-height: 1.8; color: #333; margin-left: 20px;">
                <li><strong>X√°c ƒë·ªãnh tu·ªïi c·ªï v·∫≠t</strong>: Ph∆∞∆°ng ph√°p Carbon-14 (T = 5730 nƒÉm)</li>
                <li><strong>Y h·ªçc h·∫°t nh√¢n</strong>: S·ª≠ d·ª•ng ƒë·ªìng v·ªã ph√≥ng x·∫° ƒë·ªÉ ch·∫©n ƒëo√°n v√† ƒëi·ªÅu tr·ªã b·ªánh</li>
                <li><strong>NƒÉng l∆∞·ª£ng h·∫°t nh√¢n</strong>: Ph·∫£n ·ª©ng ph√¢n r√£ trong l√≤ ph·∫£n ·ª©ng h·∫°t nh√¢n</li>
                <li><strong>ƒê·ªãa ch·∫•t h·ªçc</strong>: X√°c ƒë·ªãnh tu·ªïi Tr√°i ƒê·∫•t v√† c√°c m·∫´u ƒë√° (Uranium-238: T = 4,5 t·ª∑ nƒÉm)</li>
            </ul>
        </div>
    </div>

    <script>
        // ==================== KH·ªûI T·∫†O C√ÅC BI·∫æN TO√ÄN C·ª§C ====================
        
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const chartCanvas = document.getElementById('chart');
        const chartCtx = chartCanvas.getContext('2d');
        
        // Thi·∫øt l·∫≠p k√≠ch th∆∞·ªõc canvas th·ª±c t·∫ø
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        chartCanvas.width = chartCanvas.offsetWidth;
        chartCanvas.height = chartCanvas.offsetHeight;
        
        // Bi·∫øn tr·∫°ng th√°i m√¥ ph·ªèng
        let isRunning = false;
        let animationId = null;
        let startTime = null;
        let pausedTime = 0;
        let currentTime = 0;
        
        // Tham s·ªë v·∫≠t l√Ω
        let N0 = 500;  // S·ªë h·∫°t ban ƒë·∫ßu
        let T = 5;     // Chu k·ª≥ b√°n r√£ (gi√¢y)
        
        // M·∫£ng l∆∞u tr·ªØ c√°c h·∫°t nh√¢n
        let particles = [];
        
        // D·ªØ li·ªáu cho ƒë·ªì th·ªã
        let chartData = {
            times: [],
            remaining: [],
            theoretical: []
        };
        
        // ==================== L·∫§Y C√ÅC PH·∫¶N T·ª¨ DOM ====================
        
        const n0Slider = document.getElementById('n0-slider');
        const tSlider = document.getElementById('t-slider');
        const n0Value = document.getElementById('n0-value');
        const tValue = document.getElementById('t-value');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const timeDisplay = document.getElementById('time-display');
        const remainingDisplay = document.getElementById('remaining-display');
        const decayedDisplay = document.getElementById('decayed-display');
        const percentDisplay = document.getElementById('percent-display');
        const progressRemaining = document.getElementById('progress-remaining');
        const progressDecayed = document.getElementById('progress-decayed');
        const remainingPercent = document.getElementById('remaining-percent');
        const decayedPercent = document.getElementById('decayed-percent');
        const ratioText = document.getElementById('ratio-text');
        
        // ==================== L·ªöP PARTICLE (H·∫†T NH√ÇN) ====================
        
        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 3;
                this.isDecayed = false;
                this.decayTime = null; // Th·ªùi ƒëi·ªÉm h·∫°t n√†y s·∫Ω ph√¢n r√£
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.isDecayed ? '#555555' : '#ff3333';
                ctx.fill();
                ctx.strokeStyle = this.isDecayed ? '#333333' : '#cc0000';
                ctx.lineWidth = 1;
                ctx.stroke();
            }
        }
        
        // ==================== H√ÄM KH·ªûI T·∫†O C√ÅC H·∫†T NH√ÇN ====================
        
        function initParticles() {
            particles = [];
            const padding = 20;
            const cols = Math.floor(Math.sqrt(N0 * (canvas.width / canvas.height)));
            const rows = Math.ceil(N0 / cols);
            const spacingX = (canvas.width - 2 * padding) / (cols + 1);
            const spacingY = (canvas.height - 2 * padding) / (rows + 1);
            
            for (let i = 0; i < N0; i++) {
                const col = i % cols;
                const row = Math.floor(i / cols);
                const x = padding + (col + 1) * spacingX + (Math.random() - 0.5) * 10;
                const y = padding + (row + 1) * spacingY + (Math.random() - 0.5) * 10;
                
                // T√≠nh to√°n th·ªùi ƒëi·ªÉm ph√¢n r√£ ng·∫´u nhi√™n cho m·ªói h·∫°t
                // S·ª≠ d·ª•ng ph√¢n ph·ªëi x√°c su·∫•t m≈© ƒë·ªÉ m√¥ ph·ªèng qu√° tr√¨nh ph√¢n r√£ ng·∫´u nhi√™n
                const randomFactor = -Math.log(Math.random());
                const decayTime = randomFactor * T / Math.LN2;
                
                const particle = new Particle(x, y);
                particle.decayTime = decayTime;
                particles.push(particle);
            }
            
            drawParticles();
        }
        
        // ==================== H√ÄM V·∫º ƒê·ªí TH·ªä ====================
        
        function drawChart() {
            const width = chartCanvas.width;
            const height = chartCanvas.height;
            const padding = 40;
            
            // X√≥a canvas
            chartCtx.clearRect(0, 0, width, height);
            
            if (chartData.times.length < 2) return;
            
            // T√¨m gi√° tr·ªã max cho tr·ª•c Y
            const maxY = N0;
            const maxX = Math.max(...chartData.times);
            
            // V·∫Ω n·ªÅn
            chartCtx.fillStyle = '#f9f9f9';
            chartCtx.fillRect(0, 0, width, height);
            
            // V·∫Ω l∆∞·ªõi
            chartCtx.strokeStyle = '#e0e0e0';
            chartCtx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (height - 2 * padding) * i / 5;
                chartCtx.beginPath();
                chartCtx.moveTo(padding, y);
                chartCtx.lineTo(width - padding, y);
                chartCtx.stroke();
                
                // Nh√£n tr·ª•c Y
                chartCtx.fillStyle = '#666';
                chartCtx.font = '11px Arial';
                chartCtx.textAlign = 'right';
                chartCtx.fillText(Math.round(maxY * (5 - i) / 5), padding - 5, y + 4);
            }
            
            // V·∫Ω tr·ª•c
            chartCtx.strokeStyle = '#333';
            chartCtx.lineWidth = 2;
            chartCtx.beginPath();
            chartCtx.moveTo(padding, padding);
            chartCtx.lineTo(padding, height - padding);
            chartCtx.lineTo(width - padding, height - padding);
            chartCtx.stroke();
            
            // Nh√£n tr·ª•c
            chartCtx.fillStyle = '#333';
            chartCtx.font = 'bold 12px Arial';
            chartCtx.textAlign = 'center';
            chartCtx.fillText('Th·ªùi gian (s)', width / 2, height - 10);
            chartCtx.save();
            chartCtx.translate(15, height / 2);
            chartCtx.rotate(-Math.PI / 2);
            chartCtx.fillText('S·ªë h·∫°t nh√¢n', 0, 0);
            chartCtx.restore();
            
            // H√†m chuy·ªÉn ƒë·ªïi t·ªça ƒë·ªô
            const toX = (t) => padding + (width - 2 * padding) * (t / maxX);
            const toY = (n) => height - padding - (height - 2 * padding) * (n / maxY);
            
            // V·∫Ω ƒë∆∞·ªùng l√Ω thuy·∫øt (m√†u xanh ƒë·∫≠m, n√©t ƒë·ª©t)
            chartCtx.strokeStyle = '#667eea';
            chartCtx.lineWidth = 3;
            chartCtx.setLineDash([5, 5]);
            chartCtx.beginPath();
            for (let i = 0; i < chartData.theoretical.length; i++) {
                const x = toX(chartData.times[i]);
                const y = toY(chartData.theoretical[i]);
                if (i === 0) chartCtx.moveTo(x, y);
                else chartCtx.lineTo(x, y);
            }
            chartCtx.stroke();
            chartCtx.setLineDash([]);
            
            // V·∫Ω ƒë∆∞·ªùng th·ª±c t·∫ø (m√†u ƒë·ªè, n√©t li·ªÅn)
            chartCtx.strokeStyle = '#ff3333';
            chartCtx.lineWidth = 2;
            chartCtx.beginPath();
            for (let i = 0; i < chartData.remaining.length; i++) {
                const x = toX(chartData.times[i]);
                const y = toY(chartData.remaining[i]);
                if (i === 0) chartCtx.moveTo(x, y);
                else chartCtx.lineTo(x, y);
            }
            chartCtx.stroke();
            
            // V·∫Ω c√°c ƒëi·ªÉm ƒëo
            chartData.remaining.forEach((n, i) => {
                const x = toX(chartData.times[i]);
                const y = toY(n);
                chartCtx.fillStyle = '#ff3333';
                chartCtx.beginPath();
                chartCtx.arc(x, y, 3, 0, Math.PI * 2);
                chartCtx.fill();
            });
            
            // V·∫Ω ch√∫ th√≠ch
            const legendX = width - padding - 120;
            const legendY = padding + 20;
            
            // ƒê∆∞·ªùng l√Ω thuy·∫øt
            chartCtx.strokeStyle = '#667eea';
            chartCtx.lineWidth = 3;
            chartCtx.setLineDash([5, 5]);
            chartCtx.beginPath();
            chartCtx.moveTo(legendX, legendY);
            chartCtx.lineTo(legendX + 30, legendY);
            chartCtx.stroke();
            chartCtx.setLineDash([]);
            chartCtx.fillStyle = '#667eea';
            chartCtx.font = '11px Arial';
            chartCtx.textAlign = 'left';
            chartCtx.fillText('L√Ω thuy·∫øt', legendX + 35, legendY + 4);
            
            // ƒê∆∞·ªùng th·ª±c t·∫ø
            chartCtx.strokeStyle = '#ff3333';
            chartCtx.lineWidth = 2;
            chartCtx.beginPath();
            chartCtx.moveTo(legendX, legendY + 20);
            chartCtx.lineTo(legendX + 30, legendY + 20);
            chartCtx.stroke();
            chartCtx.fillStyle = '#ff3333';
            chartCtx.fillText('Th·ª±c t·∫ø', legendX + 35, legendY + 24);
        }
        
        function drawParticles() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            particles.forEach(particle => particle.draw());
        }
        
        // ==================== H√ÄM T√çNH TO√ÅN S·ªê H·∫†T C√íN L·∫†I THEO C√îNG TH·ª®C ====================
        
        /**
         * C√¥ng th·ª©c ph√¢n r√£ ph√≥ng x·∫°: N(t) = N‚ÇÄ ¬∑ (1/2)^(t/T)
         * @param {number} t - Th·ªùi gian hi·ªán t·∫°i (gi√¢y)
         * @returns {number} - S·ªë h·∫°t nh√¢n c√≤n l·∫°i
         */
        function calculateRemainingParticles(t) {
            return N0 * Math.pow(0.5, t / T);
        }
        
        // ==================== H√ÄM C·∫¨P NH·∫¨T TR·∫†NG TH√ÅI C√ÅC H·∫†T NH√ÇN ====================
        
        function updateParticles(t) {
            // T√≠nh s·ªë h·∫°t c√≤n l·∫°i theo c√¥ng th·ª©c l√Ω thuy·∫øt
            const theoreticalRemaining = calculateRemainingParticles(t);
            
            // ƒê√°nh d·∫•u c√°c h·∫°t ƒë√£ ph√¢n r√£ d·ª±a tr√™n th·ªùi gian ph√¢n r√£ ƒë√£ t√≠nh tr∆∞·ªõc
            particles.forEach(particle => {
                if (!particle.isDecayed && t >= particle.decayTime) {
                    particle.isDecayed = true;
                }
            });
            
            // ƒê·∫øm s·ªë h·∫°t th·ª±c t·∫ø c√≤n l·∫°i
            const actualRemaining = particles.filter(p => !p.isDecayed).length;
            const decayed = N0 - actualRemaining;
            const percentRemaining = (actualRemaining / N0) * 100;
            const percentDecayed = (decayed / N0) * 100;
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã s·ªë li·ªáu
            timeDisplay.textContent = t.toFixed(1) + 's';
            remainingDisplay.textContent = actualRemaining;
            decayedDisplay.textContent = decayed;
            percentDisplay.textContent = percentRemaining.toFixed(1) + '%';
            
            // C·∫≠p nh·∫≠t thanh progress
            progressRemaining.style.width = percentRemaining + '%';
            progressDecayed.style.width = percentDecayed + '%';
            remainingPercent.textContent = Math.round(percentRemaining) + '%';
            decayedPercent.textContent = percentDecayed > 5 ? Math.round(percentDecayed) + '%' : '';
            ratioText.textContent = `${Math.round(percentRemaining)}% c√≤n l·∫°i | ${Math.round(percentDecayed)}% ƒë√£ ph√¢n r√£`;
            
            // C·∫≠p nh·∫≠t d·ªØ li·ªáu ƒë·ªì th·ªã (m·ªói 0.2 gi√¢y)
            if (chartData.times.length === 0 || t - chartData.times[chartData.times.length - 1] >= 0.2) {
                chartData.times.push(t);
                chartData.remaining.push(actualRemaining);
                chartData.theoretical.push(theoreticalRemaining);
                
                // Gi·ªõi h·∫°n s·ªë ƒëi·ªÉm ƒë·ªÉ tr√°nh qu√° t·∫£i
                if (chartData.times.length > 100) {
                    chartData.times.shift();
                    chartData.remaining.shift();
                    chartData.theoretical.shift();
                }
            }
        }
        
        // ==================== H√ÄM ANIMATION CH√çNH ====================
        
        function animate(timestamp) {
            if (!isRunning) return;
            
            if (!startTime) {
                startTime = timestamp;
            }
            
            // T√≠nh th·ªùi gian hi·ªán t·∫°i (t√≠nh c·∫£ th·ªùi gian ƒë√£ t·∫°m d·ª´ng)
            currentTime = (timestamp - startTime) / 1000 + pausedTime;
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i c√°c h·∫°t
            updateParticles(currentTime);
            
            // V·∫Ω l·∫°i canvas v√† ƒë·ªì th·ªã
            drawParticles();
            drawChart();
            
            // Ti·∫øp t·ª•c animation
            animationId = requestAnimationFrame(animate);
        }
        
        // ==================== X·ª¨ L√ù S·ª± KI·ªÜN SLIDER ====================
        
        n0Slider.addEventListener('input', (e) => {
            N0 = parseInt(e.target.value);
            n0Value.textContent = N0;
            if (!isRunning) {
                resetSimulation();
            }
        });
        
        tSlider.addEventListener('input', (e) => {
            T = parseFloat(e.target.value);
            tValue.textContent = T.toFixed(1) + 's';
        });
        
        // ==================== X·ª¨ L√ù C√ÅC N√öT ƒêI·ªÄU KHI·ªÇN ====================
        
        startBtn.addEventListener('click', () => {
            if (!isRunning) {
                isRunning = true;
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                n0Slider.disabled = true;
                
                // B·∫Øt ƒë·∫ßu animation
                startTime = null;
                animationId = requestAnimationFrame(animate);
            }
        });
        
        pauseBtn.addEventListener('click', () => {
            if (isRunning) {
                isRunning = false;
                pausedTime = currentTime;
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            }
        });
        
        resetBtn.addEventListener('click', () => {
            resetSimulation();
        });
        
        // ==================== H√ÄM RESET M√î PH·ªéNG ====================
        
        function resetSimulation() {
            // D·ª´ng animation
            isRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            
            // Reset c√°c bi·∫øn th·ªùi gian
            startTime = null;
            pausedTime = 0;
            currentTime = 0;
            
            // Reset UI
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            n0Slider.disabled = false;
            
            // Kh·ªüi t·∫°o l·∫°i c√°c h·∫°t
            initParticles();
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã
            timeDisplay.textContent = '0.0s';
            remainingDisplay.textContent = N0;
            decayedDisplay.textContent = '0';
            percentDisplay.textContent = '100%';
        }
        
        // ==================== KH·ªûI T·∫†O BAN ƒê·∫¶U ====================
        
        // Kh·ªüi t·∫°o m√¥ ph·ªèng khi trang ƒë∆∞·ª£c t·∫£i
        initParticles();
        
        // X·ª≠ l√Ω thay ƒë·ªïi k√≠ch th∆∞·ªõc c·ª≠a s·ªï
        window.addEventListener('resize', () => {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            if (!isRunning) {
                initParticles();
            }
        });
    </script>
</body>
</html>